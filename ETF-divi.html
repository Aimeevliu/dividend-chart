import pandas as pd

# è®€å– CSV ä¸¦è™•ç† ETF ä»£è™Ÿè£œé›¶
df = pd.read_csv("ETF_å…¬å‘Š_æ”¶ç›Šè³‡è¨Š.csv")
df["äº¤æ˜“è­‰åˆ¸ä»£è™Ÿ"] = df["äº¤æ˜“è­‰åˆ¸ä»£è™Ÿ"].astype(str).str.zfill(5)

# æ¬„ä½é‡å‘½å
df = df.rename(columns={
    "äº¤æ˜“è­‰åˆ¸ä»£è™Ÿ": "ETFä»£è™Ÿ",
    "äº¤æ˜“è­‰åˆ¸åç¨±": "ETFåç¨±",
    "ç¾é‡‘æ”¶ç›Šå…¬å¸ƒæ—¥æœŸ": "å…¬å‘Šæ—¥æœŸ",
    "åœæ­¢è¨˜è¼‰è®Šæ›´èµ·æ—¥": "åœæ­¢è¨˜è¼‰è®Šæ›´èµ·æ—¥",
    "æ”¶ç›Šåˆ†é…åŸºæº–æ—¥": "æ”¶ç›Šåˆ†é…åŸºæº–æ—¥",
    "é™¤æ¯äº¤æ˜“æ—¥": "é™¤æ¯æ—¥",
    "æ”¶ç›Šåˆ†é…ç™¼æ”¾æ—¥": "ç™¼æ”¾æ—¥",
    "é ä¼°æ¯å–®ä½é…ç™¼é‡‘é¡": "é ä¼°é…ç™¼é‡‘é¡"
})

# è£œé½Šæ¬„ä½èˆ‡ NaN è™•ç†
if "å…¬å‘Šé€£çµ" not in df.columns:
    df["å…¬å‘Šé€£çµ"] = "-"
df.fillna("-", inplace=True)
df["é ä¼°é…ç™¼é‡‘é¡"] = pd.to_numeric(df["é ä¼°é…ç™¼é‡‘é¡"], errors="coerce").fillna(0)

# å»ºç«‹ HTML è¡¨æ ¼è³‡æ–™åˆ—
rows = ""
for _, row in df.iterrows():
    rows += "            <tr>\n"
    for col in ["ETFä»£è™Ÿ", "ETFåç¨±", "é™¤æ¯æ—¥", "ç™¼æ”¾æ—¥", "é ä¼°é…ç™¼é‡‘é¡"]:
        rows += f"                <td style='white-space: nowrap'>{row.get(col, '-')}</td>\n"
    link = row.get("å…¬å‘Šé€£çµ", "-")
    rows += f'                <td>{link}</td>\n'
    rows += "            </tr>\n"

# HTML æ¨¡æ¿
html = f"""<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ETF æœ€æ–°æ”¶ç›Šåˆ†é…å…¬å‘Š</title>
    <style>
        body {{ font-family: Arial, sans-serif; background-color: #f9f9f9; color: #333; padding: 20px; text-align: center; }}
        h2 {{ font-size: 24px; font-weight: bold; margin-bottom: 15px; }}
        input {{ width: 50%; max-width: 400px; padding: 10px; margin-bottom: 20px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; text-align: center; }}
        table {{ width: 100%; border-collapse: collapse; table-layout: auto; }}
        th {{ background-color: #f4f4f4; padding: 12px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 1; cursor: pointer; white-space: nowrap; }}
        td {{ padding: 12px; text-align: center; border-bottom: 1px solid #ddd; word-break: break-word; white-space: nowrap; }}
        tr:nth-child(even) {{ background-color: #f9f9f9; }}
        tr:hover {{ background-color: #f1f1f1; }}
        a {{ text-decoration: none; color: #007bff; font-size: 14px; }}
        a:hover {{ text-decoration: underline; }}
        .asc::after {{ content: " â¬†ï¸"; }}
        .desc::after {{ content: " â¬‡ï¸"; }}
    </style>
</head>
<body>
    <h2>ETF æœ€æ–°é…æ¯å…¬å‘Š</h2>
    <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹ä»£è™Ÿã€åç¨±æˆ–å…¬å‘Šå…§å®¹" onkeyup="filterTable()">
    <table id="dataTable">
        <thead>
            <tr>
                <th onclick="sortTable(0, this)">ETFä»£è™Ÿ</th>
                <th>ETFåç¨±</th>
                <th onclick="sortTable(2, this)">é™¤æ¯æ—¥</th>
                <th onclick="sortTable(3, this)">è‚¡æ¯ç™¼æ”¾æ—¥</th>
                <th onclick="sortTable(4, this)">é ä¼°é…æ¯</th>
                <th>å…¬å‘Šé€£çµ</th>
            </tr>
        </thead>
        <tbody>
{rows}
        </tbody>
    </table>
    <script>
        function filterTable() {{
            const input = document.getElementById("searchInput").value.toLowerCase();
            const rows = document.querySelectorAll("#dataTable tbody tr");
            rows.forEach(row => {{
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(input) ? "" : "none";
            }});
        }}

        function sortTable(n, thElement) {{
            const table = document.getElementById("dataTable");
            const tbody = table.tBodies[0];
            const rowsArray = Array.from(tbody.querySelectorAll("tr"));
            const isAsc = thElement.classList.contains("asc");

            Array.from(table.querySelectorAll("th")).forEach(th => th.classList.remove("asc", "desc"));
            thElement.classList.toggle("asc", !isAsc);
            thElement.classList.toggle("desc", isAsc);

            rowsArray.sort((a, b) => {{
                const x = a.children[n].innerText.trim();
                const y = b.children[n].innerText.trim();

                const xNum = parseFloat(x.replace(/[^\d.-]/g, ""));
                const yNum = parseFloat(y.replace(/[^\d.-]/g, ""));
                const dateX = new Date(x);
                const dateY = new Date(y);

                let cmp = 0;
                if (!isNaN(xNum) && !isNaN(yNum)) {{
                    cmp = xNum - yNum;
                }} else if (!isNaN(dateX.getTime()) && !isNaN(dateY.getTime())) {{
                    cmp = dateX - dateY;
                }} else {{
                    cmp = x.localeCompare(y);
                }}

                return isAsc ? -cmp : cmp;
            }});

            rowsArray.forEach(row => tbody.appendChild(row));
        }}
    </script>
</body>
</html>
"""

# å„²å­˜ HTML æª”æ¡ˆ
with open("ETF_æ”¶ç›Šå…¬å‘Šé .html", "w", encoding="utf-8-sig") as f:
    f.write(html)

print("âœ… å·²å„²å­˜ç‚º ETF_æ”¶ç›Šå…¬å‘Šé .html")
